\chapter{Bilder, Farbe und Perzeption}
In der Computergrafik geht es um die Erzeugung und Manipulation von Bildern.
Diese Bilder sind meiste 2D Arrays aus farbigen Pixeln.
Der Speicher, in dem die Farbe mit drei Werten für rot, grün und blau gespeichert wird, heißt \introduce{Framebuffer}.
Heutzutage sind 8 Bit pro Farbe in einem Framebuffer üblich.
Steht weniger zur Verfügung, müssen fehlende Farben durch Anordnung verfügbarer Farben nachgebildet werden.
Sind die Pixel ausreichend klein, werden so Mischfarben wahrgenommen.

\section{Transferfunktion}
Höhere RGB-Werte bedeuten eine hellere Farbe.
Wie hell genau eine Farbe erscheint, wird durch eine \introduce{Transferfunktion $f$} beschrieben.
Man kann die Transferfunktion für ein Graustufenbild oder per Farbkanal betrachten.
\[
	f : \left[0, N\right] \to \left[I_{min}, I_{max}\right]
\]
Dabei bildet $f$ vom Wert des Pixels auf eine Helligkeit zwischen der minimalen und maximalen Displayhelligkeit $I_{min}$ und $I_{max}$ ab.
Sie hängt von den physikalischen Eigenschaften des Displays ab.

Die maximale Helligkeit $I_{max}$ gibt an, wie hell ein Pixel sein kann.
Bei LCDs beträgt sie meist weniger als $10\%$ der Hintergrundbeleuchtung des Displays.
Die minimale Helliglkeit $I_{min}$ ist die Menge Licht, die für ein schwarzes Pixel emmitiert wird.

Neben dem vom Display emmitierten Licht, reflektiert auch noch Umgebungslicht mit Intensität $k$ an der Oberfläche.
Dieses hat einen großen Einfluss auf den Kontrast, der am Bildschirm wahrgenommen werden kann.
Der \introduce{Dynamikumfang}
\[
	R_d := \frac{I_{max} + k}{I_{min} + k}
\]
beschreibt den maximalen Kontrast des Displays.

Die Transferfunktion sollte so ausfallen, dass aufeinander folgende Pixelwerte keinen sichtbaren Helligkeitsunterschied haben.
Ist diese Forderung nicht erfüllt, können Bänder auf glatten Bildbereichen erscheinen.
Menschen können einen Helligkeitsunterschied von etwa 2\% wahrnehmen.
In dunklen Bereichen werden also kleinere Schritte der Transferfunktion benötigt.

\subsection{Quantisierung}
Die Transferfunktion kann verschieden quantisiert sein.
Die verschiedenen Möglichkeiten unterscheiden sich dabei in der größe der Helligkeitsschritte zwischen aufeinander folgenden Farbwerten.

Bei einer \introduce{linearen Quantisierung} (gleich große Helligkeitsschritte), muss jeder Schritt kleiner als 2\% von $I_{min}$ betragen.
Um Helligkeiten bis $I_{max}$ darzustellen werden
\[
	\frac{I_{max} - I_{min}}{0.02 \cdot I_{min}}
\]
Schritte benötigt.
Bei LCDs mit Dynamikumfang 100:1 sind dies etwa 5000 Schritte.
Dies würde 12-13 Bit pro Farbkanal erfordern.
Vorteil der linearen Quantisierung ist jedoch die einfache Arithmetik mit Pixelwerten.

Alternativ könnte die Transferfunktion exponentiell quantisiert sein, mit genau 2\% zwischen zwei Pixelwerten.
Bei einer \introduce{exponentiellen Quantisierung} ist $0 \mapsto I_{min}$, $1 \mapsto 1.02 \cdot I_{min}$, $2 \mapsto 1.02^2 \cdot I_{min}$, usw.
Da $\log_{10} 1.02 \approx \frac{1}{120}$, werden ca. 120 Schritte für eine Verzehnfachung der Helligkeit benötigt.
In diesem Fall reichen also 8 Bit gerade aus, um die 240 Schritte zu ermöglichen, die ein LCD mit Dynamikumfang 100:1 bräuchte.

Als Approximation der exponentiallen Quantisierung wird in der Praxis häufig eine \introduce{potenzfunktion basierte Quantisierung} eingesetzt.
\[
	I(n) = \left(\frac{n}{N}\right)^\gamma \cdot I_{max}
\]
Der Exponent $\gamma$ muss in diesem Fall immer mit angegeben werden.
Ist $\gamma = 1$ hat man eine lineare Quantisierung.

\subsection{$\gamma$-Korrektur}
In diesem Abschnitt gelten vereinfachend die Idealwerte $I_{min} = k = 0$ und $I_{max} = 1$.
Mit insgesamt $N$ Schritten ($N = 256$ bei $8$ Bit) wird ein Pixelwert $n$ auf die Intensität $I(n)$ abgebildet.
\[
	I(n) \propto \left(\frac{n}{N}\right)^\gamma
\]
Der $\gamma$-Wert charakterisiert das Display.
In der Computergrafik wird ein Pixelwert $\alpha$ aber üblicherweise in einem linearen Raum berechnet.
Bei der Darstellung will man, dass ein doppelter Wert doppelte Helligkeit bedeutet.
Pixelwerte werden daher \emph{direkt vor der Darstellung} einer \introduce{$\gamma$-Korrektur} unterzogen.
Damit $I(n) \propto \alpha$ ist, wird $\alpha \propto \alpha^{\frac{1}{\gamma}}$ verwendet.
Diese Korrektur wird unabhängig für jede Primärfarbe durchgeführt.
